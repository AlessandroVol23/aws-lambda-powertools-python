<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.5" />
<title>aws_lambda_powertools.metrics.base API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>aws_lambda_powertools.metrics.base</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import datetime
import json
import logging
import numbers
import os
import pathlib
from typing import Dict, List, Union

import fastjsonschema

from aws_lambda_powertools.helper.models import MetricUnit

from .exceptions import MetricUnitError, MetricValueError, SchemaValidationError, UniqueNamespaceError

logger = logging.getLogger(__name__)
logger.setLevel(os.getenv(&#34;LOG_LEVEL&#34;, &#34;INFO&#34;))

_schema_path = pathlib.Path(__file__).parent / &#34;./schema.json&#34;
with _schema_path.open() as f:
    CLOUDWATCH_EMF_SCHEMA = json.load(f)


class MetricManager:
    &#34;&#34;&#34;Base class for metric functionality (namespace, metric, dimension, serialization)

    MetricManager creates metrics asynchronously thanks to CloudWatch Embedded Metric Format (EMF).
    CloudWatch EMF can create up to 100 metrics per EMF object
    and metrics, dimensions, and namespace created via MetricManager
    will adhere to the schema, will be serialized and validated against EMF Schema.

    **Use `aws_lambda_powertools.metrics.metrics.Metrics` or
    `aws_lambda_powertools.metrics.metric.single_metric` to create EMF metrics.**

    Environment variables
    ---------------------
    POWERTOOLS_METRICS_NAMESPACE : str
        metric namespace to be set for all metrics

    Raises
    ------
    MetricUnitError
        When metric metric isn&#39;t supported by CloudWatch
    MetricValueError
        When metric value isn&#39;t a number
    UniqueNamespaceError
        When an additional namespace is set
    SchemaValidationError
        When metric object fails EMF schema validation
    &#34;&#34;&#34;

    def __init__(self, metric_set: Dict[str, str] = None, dimension_set: Dict = None, namespace: str = None):
        self.metric_set = metric_set or {}
        self.dimension_set = dimension_set or {}
        self.namespace = os.getenv(&#34;POWERTOOLS_METRICS_NAMESPACE&#34;) or namespace

    def add_namespace(self, name: str):
        &#34;&#34;&#34;Adds given metric namespace

        Example
        -------
        **Add metric namespace**

            metric.add_namespace(name=&#34;ServerlessAirline&#34;)

        Parameters
        ----------
        name : str
            Metric namespace
        &#34;&#34;&#34;
        if self.namespace is not None:
            raise UniqueNamespaceError(
                f&#34;Namespace &#39;{self.namespace}&#39; already set - Only one namespace is allowed across metrics&#34;
            )
        logger.debug(f&#34;Adding metrics namespace: {name}&#34;)
        self.namespace = name

    def add_metric(self, name: str, unit: MetricUnit, value: Union[float, int]):
        &#34;&#34;&#34;Adds given metric

        Example
        -------
        **Add given metric using MetricUnit enum**

            metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=MetricUnit.Count, value=1)

        **Add given metric using plain string as value unit**

            metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=&#34;Count&#34;, value=1)

        Parameters
        ----------
        name : str
            Metric name
        unit : MetricUnit
            `aws_lambda_powertools.helper.models.MetricUnit`
        value : float
            Metric value

        Raises
        ------
        MetricUnitError
            When metric unit is not supported by CloudWatch
        &#34;&#34;&#34;
        if len(self.metric_set) == 100:
            logger.debug(&#34;Exceeded maximum of 100 metrics - Publishing existing metric set&#34;)
            metrics = self.serialize_metric_set()
            print(json.dumps(metrics))
            self.metric_set = {}

        if not isinstance(value, numbers.Number):
            raise MetricValueError(f&#34;{value} is not a valid number&#34;)

        if not isinstance(unit, MetricUnit):
            try:
                unit = MetricUnit[unit]
            except KeyError:
                unit_options = list(MetricUnit.__members__)
                raise MetricUnitError(f&#34;Invalid metric unit &#39;{unit}&#39;, expected either option: {unit_options}&#34;)

        metric = {&#34;Unit&#34;: unit.value, &#34;Value&#34;: float(value)}
        logger.debug(f&#34;Adding metric: {name} with {metric}&#34;)
        self.metric_set[name] = metric

    def serialize_metric_set(self, metrics: Dict = None, dimensions: Dict = None) -&gt; Dict:
        &#34;&#34;&#34;Serializes metric and dimensions set

        Parameters
        ----------
        metrics : Dict, optional
            Dictionary of metrics to serialize, by default None
        dimensions : Dict, optional
            Dictionary of dimensions to serialize, by default None

        Example
        -------
        **Serialize metrics into EMF format**

            metrics = MetricManager()
            # ...add metrics, dimensions, namespace
            ret = metrics.serialize_metric_set()

        Returns
        -------
        Dict
            Serialized metrics following EMF specification

        Raises
        ------
        SchemaValidationError
            Raised when serialization fail schema validation
        &#34;&#34;&#34;
        if metrics is None:
            metrics = self.metric_set

        if dimensions is None:
            dimensions = self.dimension_set

        logger.debug(&#34;Serializing...&#34;, {&#34;metrics&#34;: metrics, &#34;dimensions&#34;: dimensions})

        dimension_keys: List[str] = list(dimensions.keys())
        metric_names_unit: List[Dict[str, str]] = []
        metric_set: Dict[str, str] = {}

        for metric_name in metrics:
            metric: str = metrics[metric_name]
            metric_value: int = metric.get(&#34;Value&#34;, 0)
            metric_unit: str = metric.get(&#34;Unit&#34;)

            if metric_value &gt; 0 and metric_unit is not None:
                metric_names_unit.append({&#34;Name&#34;: metric_name, &#34;Unit&#34;: metric[&#34;Unit&#34;]})
                metric_set.update({metric_name: metric[&#34;Value&#34;]})

        metrics_definition = {
            &#34;CloudWatchMetrics&#34;: [
                {&#34;Namespace&#34;: self.namespace, &#34;Dimensions&#34;: [dimension_keys], &#34;Metrics&#34;: metric_names_unit}
            ]
        }
        metrics_timestamp = {&#34;Timestamp&#34;: int(datetime.datetime.now().timestamp() * 1000)}
        metric_set[&#34;_aws&#34;] = {**metrics_timestamp, **metrics_definition}

        try:
            logger.debug(&#34;Validating serialized metrics against CloudWatch EMF schema&#34;, metric_set)
            fastjsonschema.validate(definition=CLOUDWATCH_EMF_SCHEMA, data=metric_set)
        except fastjsonschema.JsonSchemaException as e:
            message = f&#34;Invalid format. Error: {e.message}, Invalid item: {e.name}&#34;  # noqa: B306, E501
            raise SchemaValidationError(message)
        return metric_set

    def add_dimension(self, name: str, value: str):
        &#34;&#34;&#34;Adds given dimension to all metrics

        Example
        -------
        **Add a metric dimensions**

            metric.add_dimension(name=&#34;operation&#34;, value=&#34;confirm_booking&#34;)

        Parameters
        ----------
        name : str
            Dimension name
        value : str
            Dimension value
        &#34;&#34;&#34;
        logger.debug(f&#34;Adding dimension: {name}:{value}&#34;)
        self.dimension_set[name] = value</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="aws_lambda_powertools.metrics.base.MetricManager"><code class="flex name class">
<span>class <span class="ident">MetricManager</span></span>
<span>(</span><span>metric_set=None, dimension_set=None, namespace=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Base class for metric functionality (namespace, metric, dimension, serialization)</p>
<p>MetricManager creates metrics asynchronously thanks to CloudWatch Embedded Metric Format (EMF).
CloudWatch EMF can create up to 100 metrics per EMF object
and metrics, dimensions, and namespace created via MetricManager
will adhere to the schema, will be serialized and validated against EMF Schema.</p>
<p><strong>Use <a title="aws_lambda_powertools.metrics.metrics.Metrics" href="metrics.html#aws_lambda_powertools.metrics.metrics.Metrics"><code>Metrics</code></a> or
<a title="aws_lambda_powertools.metrics.metric.single_metric" href="metric.html#aws_lambda_powertools.metrics.metric.single_metric"><code>single_metric()</code></a> to create EMF metrics.</strong></p>
<h2 id="environment-variables">Environment variables</h2>
<dl>
<dt><strong><code>POWERTOOLS_METRICS_NAMESPACE</code></strong> :&ensp;<code>str</code></dt>
<dd>metric namespace to be set for all metrics</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>MetricUnitError</code></dt>
<dd>When metric metric isn't supported by CloudWatch</dd>
<dt><code>MetricValueError</code></dt>
<dd>When metric value isn't a number</dd>
<dt><code>UniqueNamespaceError</code></dt>
<dd>When an additional namespace is set</dd>
<dt><code>SchemaValidationError</code></dt>
<dd>When metric object fails EMF schema validation</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class MetricManager:
    &#34;&#34;&#34;Base class for metric functionality (namespace, metric, dimension, serialization)

    MetricManager creates metrics asynchronously thanks to CloudWatch Embedded Metric Format (EMF).
    CloudWatch EMF can create up to 100 metrics per EMF object
    and metrics, dimensions, and namespace created via MetricManager
    will adhere to the schema, will be serialized and validated against EMF Schema.

    **Use `aws_lambda_powertools.metrics.metrics.Metrics` or
    `aws_lambda_powertools.metrics.metric.single_metric` to create EMF metrics.**

    Environment variables
    ---------------------
    POWERTOOLS_METRICS_NAMESPACE : str
        metric namespace to be set for all metrics

    Raises
    ------
    MetricUnitError
        When metric metric isn&#39;t supported by CloudWatch
    MetricValueError
        When metric value isn&#39;t a number
    UniqueNamespaceError
        When an additional namespace is set
    SchemaValidationError
        When metric object fails EMF schema validation
    &#34;&#34;&#34;

    def __init__(self, metric_set: Dict[str, str] = None, dimension_set: Dict = None, namespace: str = None):
        self.metric_set = metric_set or {}
        self.dimension_set = dimension_set or {}
        self.namespace = os.getenv(&#34;POWERTOOLS_METRICS_NAMESPACE&#34;) or namespace

    def add_namespace(self, name: str):
        &#34;&#34;&#34;Adds given metric namespace

        Example
        -------
        **Add metric namespace**

            metric.add_namespace(name=&#34;ServerlessAirline&#34;)

        Parameters
        ----------
        name : str
            Metric namespace
        &#34;&#34;&#34;
        if self.namespace is not None:
            raise UniqueNamespaceError(
                f&#34;Namespace &#39;{self.namespace}&#39; already set - Only one namespace is allowed across metrics&#34;
            )
        logger.debug(f&#34;Adding metrics namespace: {name}&#34;)
        self.namespace = name

    def add_metric(self, name: str, unit: MetricUnit, value: Union[float, int]):
        &#34;&#34;&#34;Adds given metric

        Example
        -------
        **Add given metric using MetricUnit enum**

            metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=MetricUnit.Count, value=1)

        **Add given metric using plain string as value unit**

            metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=&#34;Count&#34;, value=1)

        Parameters
        ----------
        name : str
            Metric name
        unit : MetricUnit
            `aws_lambda_powertools.helper.models.MetricUnit`
        value : float
            Metric value

        Raises
        ------
        MetricUnitError
            When metric unit is not supported by CloudWatch
        &#34;&#34;&#34;
        if len(self.metric_set) == 100:
            logger.debug(&#34;Exceeded maximum of 100 metrics - Publishing existing metric set&#34;)
            metrics = self.serialize_metric_set()
            print(json.dumps(metrics))
            self.metric_set = {}

        if not isinstance(value, numbers.Number):
            raise MetricValueError(f&#34;{value} is not a valid number&#34;)

        if not isinstance(unit, MetricUnit):
            try:
                unit = MetricUnit[unit]
            except KeyError:
                unit_options = list(MetricUnit.__members__)
                raise MetricUnitError(f&#34;Invalid metric unit &#39;{unit}&#39;, expected either option: {unit_options}&#34;)

        metric = {&#34;Unit&#34;: unit.value, &#34;Value&#34;: float(value)}
        logger.debug(f&#34;Adding metric: {name} with {metric}&#34;)
        self.metric_set[name] = metric

    def serialize_metric_set(self, metrics: Dict = None, dimensions: Dict = None) -&gt; Dict:
        &#34;&#34;&#34;Serializes metric and dimensions set

        Parameters
        ----------
        metrics : Dict, optional
            Dictionary of metrics to serialize, by default None
        dimensions : Dict, optional
            Dictionary of dimensions to serialize, by default None

        Example
        -------
        **Serialize metrics into EMF format**

            metrics = MetricManager()
            # ...add metrics, dimensions, namespace
            ret = metrics.serialize_metric_set()

        Returns
        -------
        Dict
            Serialized metrics following EMF specification

        Raises
        ------
        SchemaValidationError
            Raised when serialization fail schema validation
        &#34;&#34;&#34;
        if metrics is None:
            metrics = self.metric_set

        if dimensions is None:
            dimensions = self.dimension_set

        logger.debug(&#34;Serializing...&#34;, {&#34;metrics&#34;: metrics, &#34;dimensions&#34;: dimensions})

        dimension_keys: List[str] = list(dimensions.keys())
        metric_names_unit: List[Dict[str, str]] = []
        metric_set: Dict[str, str] = {}

        for metric_name in metrics:
            metric: str = metrics[metric_name]
            metric_value: int = metric.get(&#34;Value&#34;, 0)
            metric_unit: str = metric.get(&#34;Unit&#34;)

            if metric_value &gt; 0 and metric_unit is not None:
                metric_names_unit.append({&#34;Name&#34;: metric_name, &#34;Unit&#34;: metric[&#34;Unit&#34;]})
                metric_set.update({metric_name: metric[&#34;Value&#34;]})

        metrics_definition = {
            &#34;CloudWatchMetrics&#34;: [
                {&#34;Namespace&#34;: self.namespace, &#34;Dimensions&#34;: [dimension_keys], &#34;Metrics&#34;: metric_names_unit}
            ]
        }
        metrics_timestamp = {&#34;Timestamp&#34;: int(datetime.datetime.now().timestamp() * 1000)}
        metric_set[&#34;_aws&#34;] = {**metrics_timestamp, **metrics_definition}

        try:
            logger.debug(&#34;Validating serialized metrics against CloudWatch EMF schema&#34;, metric_set)
            fastjsonschema.validate(definition=CLOUDWATCH_EMF_SCHEMA, data=metric_set)
        except fastjsonschema.JsonSchemaException as e:
            message = f&#34;Invalid format. Error: {e.message}, Invalid item: {e.name}&#34;  # noqa: B306, E501
            raise SchemaValidationError(message)
        return metric_set

    def add_dimension(self, name: str, value: str):
        &#34;&#34;&#34;Adds given dimension to all metrics

        Example
        -------
        **Add a metric dimensions**

            metric.add_dimension(name=&#34;operation&#34;, value=&#34;confirm_booking&#34;)

        Parameters
        ----------
        name : str
            Dimension name
        value : str
            Dimension value
        &#34;&#34;&#34;
        logger.debug(f&#34;Adding dimension: {name}:{value}&#34;)
        self.dimension_set[name] = value</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="aws_lambda_powertools.metrics.metric.SingleMetric" href="metric.html#aws_lambda_powertools.metrics.metric.SingleMetric">SingleMetric</a></li>
<li><a title="aws_lambda_powertools.metrics.metrics.Metrics" href="metrics.html#aws_lambda_powertools.metrics.metrics.Metrics">Metrics</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="aws_lambda_powertools.metrics.base.MetricManager.add_dimension"><code class="name flex">
<span>def <span class="ident">add_dimension</span></span>(<span>self, name, value)</span>
</code></dt>
<dd>
<section class="desc"><p>Adds given dimension to all metrics</p>
<h2 id="example">Example</h2>
<p><strong>Add a metric dimensions</strong></p>
<pre><code>metric.add_dimension(name="operation", value="confirm_booking")
</code></pre>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>Dimension name</dd>
<dt><strong><code>value</code></strong> :&ensp;<code>str</code></dt>
<dd>Dimension value</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_dimension(self, name: str, value: str):
    &#34;&#34;&#34;Adds given dimension to all metrics

    Example
    -------
    **Add a metric dimensions**

        metric.add_dimension(name=&#34;operation&#34;, value=&#34;confirm_booking&#34;)

    Parameters
    ----------
    name : str
        Dimension name
    value : str
        Dimension value
    &#34;&#34;&#34;
    logger.debug(f&#34;Adding dimension: {name}:{value}&#34;)
    self.dimension_set[name] = value</code></pre>
</details>
</dd>
<dt id="aws_lambda_powertools.metrics.base.MetricManager.add_metric"><code class="name flex">
<span>def <span class="ident">add_metric</span></span>(<span>self, name, unit, value)</span>
</code></dt>
<dd>
<section class="desc"><p>Adds given metric</p>
<h2 id="example">Example</h2>
<p><strong>Add given metric using MetricUnit enum</strong></p>
<pre><code>metric.add_metric(name="BookingConfirmation", unit=MetricUnit.Count, value=1)
</code></pre>
<p><strong>Add given metric using plain string as value unit</strong></p>
<pre><code>metric.add_metric(name="BookingConfirmation", unit="Count", value=1)
</code></pre>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>Metric name</dd>
<dt><strong><code>unit</code></strong> :&ensp;<code>MetricUnit</code></dt>
<dd><a title="aws_lambda_powertools.helper.models.MetricUnit" href="../helper/models.html#aws_lambda_powertools.helper.models.MetricUnit"><code>MetricUnit</code></a></dd>
<dt><strong><code>value</code></strong> :&ensp;<code>float</code></dt>
<dd>Metric value</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>MetricUnitError</code></dt>
<dd>When metric unit is not supported by CloudWatch</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_metric(self, name: str, unit: MetricUnit, value: Union[float, int]):
    &#34;&#34;&#34;Adds given metric

    Example
    -------
    **Add given metric using MetricUnit enum**

        metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=MetricUnit.Count, value=1)

    **Add given metric using plain string as value unit**

        metric.add_metric(name=&#34;BookingConfirmation&#34;, unit=&#34;Count&#34;, value=1)

    Parameters
    ----------
    name : str
        Metric name
    unit : MetricUnit
        `aws_lambda_powertools.helper.models.MetricUnit`
    value : float
        Metric value

    Raises
    ------
    MetricUnitError
        When metric unit is not supported by CloudWatch
    &#34;&#34;&#34;
    if len(self.metric_set) == 100:
        logger.debug(&#34;Exceeded maximum of 100 metrics - Publishing existing metric set&#34;)
        metrics = self.serialize_metric_set()
        print(json.dumps(metrics))
        self.metric_set = {}

    if not isinstance(value, numbers.Number):
        raise MetricValueError(f&#34;{value} is not a valid number&#34;)

    if not isinstance(unit, MetricUnit):
        try:
            unit = MetricUnit[unit]
        except KeyError:
            unit_options = list(MetricUnit.__members__)
            raise MetricUnitError(f&#34;Invalid metric unit &#39;{unit}&#39;, expected either option: {unit_options}&#34;)

    metric = {&#34;Unit&#34;: unit.value, &#34;Value&#34;: float(value)}
    logger.debug(f&#34;Adding metric: {name} with {metric}&#34;)
    self.metric_set[name] = metric</code></pre>
</details>
</dd>
<dt id="aws_lambda_powertools.metrics.base.MetricManager.add_namespace"><code class="name flex">
<span>def <span class="ident">add_namespace</span></span>(<span>self, name)</span>
</code></dt>
<dd>
<section class="desc"><p>Adds given metric namespace</p>
<h2 id="example">Example</h2>
<p><strong>Add metric namespace</strong></p>
<pre><code>metric.add_namespace(name="ServerlessAirline")
</code></pre>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>Metric namespace</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_namespace(self, name: str):
    &#34;&#34;&#34;Adds given metric namespace

    Example
    -------
    **Add metric namespace**

        metric.add_namespace(name=&#34;ServerlessAirline&#34;)

    Parameters
    ----------
    name : str
        Metric namespace
    &#34;&#34;&#34;
    if self.namespace is not None:
        raise UniqueNamespaceError(
            f&#34;Namespace &#39;{self.namespace}&#39; already set - Only one namespace is allowed across metrics&#34;
        )
    logger.debug(f&#34;Adding metrics namespace: {name}&#34;)
    self.namespace = name</code></pre>
</details>
</dd>
<dt id="aws_lambda_powertools.metrics.base.MetricManager.serialize_metric_set"><code class="name flex">
<span>def <span class="ident">serialize_metric_set</span></span>(<span>self, metrics=None, dimensions=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Serializes metric and dimensions set</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>metrics</code></strong> :&ensp;<code>Dict</code>, optional</dt>
<dd>Dictionary of metrics to serialize, by default None</dd>
<dt><strong><code>dimensions</code></strong> :&ensp;<code>Dict</code>, optional</dt>
<dd>Dictionary of dimensions to serialize, by default None</dd>
</dl>
<h2 id="example">Example</h2>
<p><strong>Serialize metrics into EMF format</strong></p>
<pre><code>metrics = MetricManager()
# ...add metrics, dimensions, namespace
ret = metrics.serialize_metric_set()
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Dict</code></dt>
<dd>Serialized metrics following EMF specification</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>SchemaValidationError</code></dt>
<dd>Raised when serialization fail schema validation</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def serialize_metric_set(self, metrics: Dict = None, dimensions: Dict = None) -&gt; Dict:
    &#34;&#34;&#34;Serializes metric and dimensions set

    Parameters
    ----------
    metrics : Dict, optional
        Dictionary of metrics to serialize, by default None
    dimensions : Dict, optional
        Dictionary of dimensions to serialize, by default None

    Example
    -------
    **Serialize metrics into EMF format**

        metrics = MetricManager()
        # ...add metrics, dimensions, namespace
        ret = metrics.serialize_metric_set()

    Returns
    -------
    Dict
        Serialized metrics following EMF specification

    Raises
    ------
    SchemaValidationError
        Raised when serialization fail schema validation
    &#34;&#34;&#34;
    if metrics is None:
        metrics = self.metric_set

    if dimensions is None:
        dimensions = self.dimension_set

    logger.debug(&#34;Serializing...&#34;, {&#34;metrics&#34;: metrics, &#34;dimensions&#34;: dimensions})

    dimension_keys: List[str] = list(dimensions.keys())
    metric_names_unit: List[Dict[str, str]] = []
    metric_set: Dict[str, str] = {}

    for metric_name in metrics:
        metric: str = metrics[metric_name]
        metric_value: int = metric.get(&#34;Value&#34;, 0)
        metric_unit: str = metric.get(&#34;Unit&#34;)

        if metric_value &gt; 0 and metric_unit is not None:
            metric_names_unit.append({&#34;Name&#34;: metric_name, &#34;Unit&#34;: metric[&#34;Unit&#34;]})
            metric_set.update({metric_name: metric[&#34;Value&#34;]})

    metrics_definition = {
        &#34;CloudWatchMetrics&#34;: [
            {&#34;Namespace&#34;: self.namespace, &#34;Dimensions&#34;: [dimension_keys], &#34;Metrics&#34;: metric_names_unit}
        ]
    }
    metrics_timestamp = {&#34;Timestamp&#34;: int(datetime.datetime.now().timestamp() * 1000)}
    metric_set[&#34;_aws&#34;] = {**metrics_timestamp, **metrics_definition}

    try:
        logger.debug(&#34;Validating serialized metrics against CloudWatch EMF schema&#34;, metric_set)
        fastjsonschema.validate(definition=CLOUDWATCH_EMF_SCHEMA, data=metric_set)
    except fastjsonschema.JsonSchemaException as e:
        message = f&#34;Invalid format. Error: {e.message}, Invalid item: {e.name}&#34;  # noqa: B306, E501
        raise SchemaValidationError(message)
    return metric_set</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="aws_lambda_powertools.metrics" href="index.html">aws_lambda_powertools.metrics</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="aws_lambda_powertools.metrics.base.MetricManager" href="#aws_lambda_powertools.metrics.base.MetricManager">MetricManager</a></code></h4>
<ul class="">
<li><code><a title="aws_lambda_powertools.metrics.base.MetricManager.add_dimension" href="#aws_lambda_powertools.metrics.base.MetricManager.add_dimension">add_dimension</a></code></li>
<li><code><a title="aws_lambda_powertools.metrics.base.MetricManager.add_metric" href="#aws_lambda_powertools.metrics.base.MetricManager.add_metric">add_metric</a></code></li>
<li><code><a title="aws_lambda_powertools.metrics.base.MetricManager.add_namespace" href="#aws_lambda_powertools.metrics.base.MetricManager.add_namespace">add_namespace</a></code></li>
<li><code><a title="aws_lambda_powertools.metrics.base.MetricManager.serialize_metric_set" href="#aws_lambda_powertools.metrics.base.MetricManager.serialize_metric_set">serialize_metric_set</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.5</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>